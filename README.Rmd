---
title: "Untitled"
output: github_document:
    toc: true
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Link to github repository  

## Required Packages  

```{r setup packages results='hide'}
library(tidyverse)
library(httr)
library(jsonlite)
```

## Write functions to contact the NHL Records API  
Note -- to help with ease of tracking variable scope -- function arguments have the letter 'a' for a prefix, variables local to the function have an 'f' for a prefix.  Global variables have a 'g' prefix.
```{r Filter Function}
#Expectation is for each of these functions to be able to take a team name and team ID
#Have two different formats for this things (stats and records APIs)
#Define one function to call, return a list of two outputs 
#first formatted for records, second formatted for stats

defineRecFilter<- function(aName = "", aNumber = "", ...)
{
  #initialize function variable
fCayenneExp= ""

#If we have a name input, filter for it
if(aName != ""){
  fCayenneExp = paste("teamCommonName=\"", aName,"\"", sep="")
  }

#If we have a number input, regardless of a name input, filter for it.
if(toString(aNumber) != ""){
  #If we already have a condition on fCayenneExp, add an ampersand (pull for both name and number)
  if(fCayenneExp != "") fCayenneExp <- paste(fCayenneExp, "&", sep="")
  
  #Regardless of needing the ampersand, Update filter for number since it was not null
  fCayenneExp <- paste(fCayenneExp, "mostRecentTeamId=", toString(aNumber), sep="")
  }

#If we have either filter string, add the literal 'cayenneExp' prefix to the variable
#otherwise the whole string stays an empty ""
if(fCayenneExp != "") fCayenneExp<- paste("?cayenneExp=", fCayenneExp, sep = "")
  
  return(fCayenneExp)
}

```

```{r Parsed Franchise}
#input options for franchise common name and franchise team id number
#function returns id, first seasonid, and last seasonid and name of every team in the history of the NHL
#https://records.nhl.com/site/api/franchise/ 
#Filter by common name
#https://records.nhl.com/site/api/franchise?cayenneExp=teamCommonName=%22Wanderers%22
#Filter by franchise ID

getFranchiseInfo<- function(...){
#Define API url and pull results
fBase<- "https://records.nhl.com/site/api/"
fEndpoint<- "franchise"
fCayenneExp<- defineRecFilter(...)
fCallURL<- paste(fBase,fEndpoint,fCayenneExp, sep="")
print(fCallURL)

#Process results into a dataframe and return
fRawJSON<- GET(fCallURL)
fJSON_text<- content(fRawJSON, "text")
fParsedText <- fromJSON(fJSON_text, flatten = TRUE)
fDF <- as.data.frame(fParsedText)

return(fDF)
}
```

```{r Parsed team totals}
#input options for franchise name and number
#function Returns total stats for every franchise (ex roadTies, roadWins, etc)
#/franchise-team-totals Total stats for every franchise (ex roadTies, roadWins, etc)
#https://records.nhl.com/site/api/franchise-team-totals
getFranchiseTotals<- function(...){
#Define API url and pull results
fBase<- "https://records.nhl.com/site/api/"
fEndpoint<- "franchise-team-totals"
fCayenneExp<- defineRecFilter(...)
fCallURL<- paste(fBase,fEndpoint,fCayenneExp, sep="")
print(fCallURL)

#Process results into a dataframe and return
fRawJSON<- GET(fCallURL)
fJSON_text<- content(fRawJSON, "text")
fParsedText <- fromJSON(fJSON_text, flatten = TRUE)
fDF <- as.data.frame(fParsedText)

return(fDF)
}
```

```{r Parsed Franchise Season Records}
#season records for a specific franchise
#https://records.nhl.com/site/api/franchise-season-records?cayenneExp=franchiseId=ID

#example query
#/franchise-season-results?cayenneExp=franchiseId=24&sort=seasonId&dir=DESC Returns every season result for a specified team, sorted by seasonId in descending order
getFranchiseSeasonRecords<- function(...){
#Define API url and pull results
fBase<- "https://records.nhl.com/site/api/"
fEndpoint<- "franchise-season-records"
fCayenneExp<- defineRecFilter(...)
fCallURL<- paste(fBase,fEndpoint,fCayenneExp, sep="")
print(fCallURL)

#Process results into a dataframe and return
fRawJSON<- GET(fCallURL)
fJSON_text<- content(fRawJSON, "text")
fParsedText <- fromJSON(fJSON_text, flatten = TRUE)
fDF <- as.data.frame(fParsedText)

return(fDF)
}
```

```{r Parsed Goalie Records}
#Goalie records for the specified franchise 
#/franchise-goalie-records?cayenneExp=franchiseId=ID
getFranchiseGoalieRecords<- function(...){
#Define API url and pull results
fBase<- "https://records.nhl.com/site/api/"
fEndpoint<- "franchise-goalie-records"
fCayenneExp<- defineRecFilter(...)
fCallURL<- paste(fBase,fEndpoint,fCayenneExp, sep="")
print(fCallURL)

#Process results into a dataframe and return
fRawJSON<- GET(fCallURL)
fJSON_text<- content(fRawJSON, "text")
fParsedText <- fromJSON(fJSON_text, flatten = TRUE)
fDF <- as.data.frame(fParsedText)

return(fDF)
}
```


```{r Parsed Skater Records}
#/franchise-skater-records?cayenneExp=franchiseId=ID Skater records, same interaction as goalie endpoint
getFranchiseSkaterRecords<- function(...){
#Define API url and pull results
fBase<- "https://records.nhl.com/site/api/"
fEndpoint<- "franchise-skater-records"
fCayenneExp<- defineRecFilter(...)
fCallURL<- paste(fBase,fEndpoint,fCayenneExp, sep="")
print(fCallURL)

#Process results into a dataframe and return
fRawJSON<- GET(fCallURL)
fJSON_text<- content(fRawJSON, "text")
fParsedText <- fromJSON(fJSON_text, flatten = TRUE)
fDF <- as.data.frame(fParsedText)

return(fDF)
}
```

```{r TestRecordsAPI}
gdfFranchiseAll<-getFranchiseInfo()
gdfFranchiseName<-getFranchiseInfo(aName="Devils")
gdfFranchiseNumber<-getFranchiseInfo(aNumber=2)

gdfFranTotal<-getFranchiseTotals()
gdfFranTotalName<-getFranchiseTotals(aName="Devils")
gdfFranTotalNumber<-getFranchiseTotals(aNumber=2)

gdfFranSeas<-getFranchiseSeasonRecords()
gdfFranSeasName<-getFranchiseSeasonRecords(aName="Devils")
gdfFranSeasNum<-getFranchiseSeasonRecords(aNumber=2)

gdfFranGoal<-getFranchiseGoalieRecords()
gdfFranGoalName<-getFranchiseGoalieRecords(aName="Devils")
gdfFranGoalNum<-getFranchiseGoalieRecords(aNumber=2)

gdfFranSkat<-getFranchiseSkaterRecords()
gdfFranSkatName<-getFranchiseSkaterRecords(aName="Devils")
gdfFranSkatNum<-getFranchiseSkaterRecords(aNumber=2)

```
```{r Stats Filter}
#Need a different filter function for the different API set.
#This version needs to resolve 
```
```{r Stats API All}
#You should have a function to return parsed data for the following endpoint from the stats API(the user should be able to specify values for any of the eight modifiers listed):âˆ—https://statsapi.web.nhl.com/api/v1/teams

#aExpand can take the following values, pulling different summary expansions:
  #"Roster", "EZRoster", "NextSched","PrevSched","Stats", "TeamList",  ""

#aSeason is a string formatted Y111Y222 restricting the pull to the season of interest.
#By default, an empty string will pull the current season where applicable
#Example:  20142015 to refer to the 2014-2015 hockey season.

#aTeams is a comma separated string of teamIDs
#Example: "4,5,29"

getTeamStats<- function(aExpand="", aSeason = "", aTeams = "", ...){
  
  #Process aExpand and aTeams where relevant
  fExpand<- switch(aexpand, "Roster" = "?expand=team.roster", "EZRoster" = "?expand=person.names", 
         "NextSched" = "?expand=team.schedule.next", "PrevSched" = "?expand=team.schedule.previous", 
         "Stats" = "?expand=team.stats", "TeamList" = paste("?teamID=", aTeams), ""="")
  
  #process aSeason
  fSeason=if(aSeason!= "") paste("&season=", aSeason)

  #Define API url and pull results
  fBase<- "https://statsapi.web.nhl.com/api/v1/"
  fEndpoint<- "teams"

  fCallURL<- paste(fBase,fEndpoint,fExpand,fSeason,sep="")
  print(fCallURL)

  #Process results into a dataframe and return
  fRawJSON<- GET(fCallURL)
  fJSON_text<- content(fRawJSON, "text")
  fParsedText <- fromJSON(fJSON_text, flatten = TRUE)
  fDF <- as.data.frame(fParsedText)

return(fDF)
}

```

```{r One-Stop-Wrapper Function}
```

##Example Analysis


## GitHub Documents

This is an R Markdown format used for publishing markdown documents to GitHub. When you click the **Knit** button all R code chunks are run and a markdown file (.md) suitable for publishing to GitHub is generated.

## Including Code

You can include R code in the document as follows:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
